<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at 2021-01-03
 | Rendered using Apache Maven Stylus Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop Amazon Web Services support &#x2013; Controlling the S3A Directory Marker Behavior</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20210103" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        <img src="http://hadoop.apache.org/images/hadoop-logo.jpg" alt="" />
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        <img src="http://www.apache.org/images/asf_logo_wide.png" alt="" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                   <div class="xleft">
                          <a href="http://www.apache.org/" class="externalLink">Apache</a>
        &gt;
                  <a href="http://hadoop.apache.org/" class="externalLink">Hadoop</a>
        &gt;
                  <a href="../../index.html">Apache Hadoop Amazon Web Services support</a>
        &gt;
        Controlling the S3A Directory Marker Behavior
        </div>
            <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
              
                                   &nbsp;| Last Published: 2021-01-03
              &nbsp;| Version: 3.2.2
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SingleCluster.html">Single Node Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ClusterSetup.html">Cluster Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CommandsManual.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FileSystemShell.html">FileSystem Shell</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Compatibility.html">Compatibility Specification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DownstreamDev.html">Downstream Developer's Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AdminCompatibilityGuide.html">Admin Compatibility Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/InterfaceClassification.html">Interface Classification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/filesystem/index.html">FileSystem Specification</a>
            </li>
          </ul>
                       <h5>Common</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CLIMiniCluster.html">CLI Mini Cluster</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/NativeLibraries.html">Native Libraries</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Superusers.html">Proxy User</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/RackAwareness.html">Rack Awareness</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SecureMode.html">Secure Mode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ServiceLevelAuth.html">Service Level Authorization</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/HttpAuthentication.html">HTTP Authentication</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CredentialProviderAPI.html">Credential Provider API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/index.html">Hadoop KMS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Tracing.html">Tracing</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellGuide.html">Unix Shell Guide</a>
            </li>
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDesign.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html">User Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html">NameNode HA With QJM</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html">NameNode HA With NFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ObserverNameNode.html">Observer NameNode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/Federation.html">Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFs.html">ViewFs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFsOverloadScheme.html">ViewFsOverloadScheme</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsSnapshots.html">Snapshots</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsEditsViewer.html">Edits Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsImageViewer.html">Image Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html">Permissions and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsQuotaAdminGuide.html">Quotas and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/LibHdfs.html">libhdfs (C API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/WebHDFS.html">WebHDFS (REST API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/index.html">HttpFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">Short Circuit Local Reads</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/CentralizedCacheManagement.html">Centralized Cache Management</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsNfsGateway.html">NFS Gateway</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html">Rolling Upgrade</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ExtendedAttributes.html">Extended Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/TransparentEncryption.html">Transparent Encryption</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html">Multihoming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ArchivalStorage.html">Storage Policies</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/MemoryStorage.html">Memory Storage Support</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/SLGUserGuide.html">Synthetic Load Generator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSErasureCoding.html">Erasure Coding</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSDiskbalancer.html">Disk Balancer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUpgradeDomain.html">Upgrade Domain</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDataNodeAdminGuide.html">DataNode Admin</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/HDFSRouterFederation.html">Router Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsProvidedStorage.html">Provided Storage</a>
            </li>
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">Tutorial</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduce_Compatibility_Hadoop1_Hadoop2.html">Compatibility with 1.x</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/EncryptedShuffle.html">Encrypted Shuffle</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/PluggableShuffleAndPluggableSort.html">Pluggable Shuffle/Sort</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/DistributedCacheDeploy.html">Distributed Cache Deploy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/SharedCacheSupport.html">Support for YARN Shared Cache</a>
            </li>
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredAppMasterRest.html">MR Application Master</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-hs/HistoryServerRest.html">MR History Server</a>
            </li>
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YARN.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html">Capacity Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/FairScheduler.html">Fair Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRestart.html">ResourceManager Restart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html">ResourceManager HA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceModel.html">Resource Model</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeLabel.html">Node Labels</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeAttributes.html">Node Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebApplicationProxy.html">Web Application Proxy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html">Timeline Service V.2</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html">Writing YARN Applications</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnApplicationSecurity.html">YARN Application Security</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManager.html">NodeManager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/DockerContainers.html">Running Applications in Docker Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html">Using CGroups</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SecureContainer.html">Secure Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/registry/index.html">Registry</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ReservationSystem.html">Reservation System</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html">Graceful Decommission</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/OpportunisticContainers.html">Opportunistic Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/Federation.html">YARN Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SharedCache.html">Shared Cache</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingGpus.html">Using GPU</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingFPGA.html">Using FPGA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/PlacementConstraints.html">Placement Constraints</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnUI2.html">YARN UI2</a>
            </li>
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebServicesIntro.html">Introduction</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html">Resource Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerRest.html">Node Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html#Timeline_Server_REST_API_v1">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html#Timeline_Service_v.2_REST_API">Timeline Service V.2</a>
            </li>
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Overview.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Concepts.html">Concepts</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/YarnServiceAPI.html">Yarn Service API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/ServiceDiscovery.html">Service Discovery</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/SystemServices.html">System Services</a>
            </li>
          </ul>
                       <h5>Submarine</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-submarine/Index.html">Index</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-submarine/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-submarine/Examples.html">Examples</a>
            </li>
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-aliyun/tools/hadoop-aliyun/index.html">Aliyun OSS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-aws/tools/hadoop-aws/index.html">Amazon S3</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure/index.html">Azure Blob Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure-datalake/index.html">Azure Data Lake Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-openstack/index.html">OpenStack Swift</a>
            </li>
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-auth/index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Examples.html">Examples</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Configuration.html">Configuration</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/BuildingIt.html">Building</a>
            </li>
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-streaming/HadoopStreaming.html">Hadoop Streaming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archives/HadoopArchives.html">Hadoop Archives</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archive-logs/HadoopArchiveLogs.html">Hadoop Archive Logs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-distcp/DistCp.html">DistCp</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-gridmix/GridMix.html">GridMix</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-rumen/Rumen.html">Rumen</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-resourceestimator/ResourceEstimator.html">Resource Estimator Service</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-sls/SchedulerLoadSimulator.html">Scheduler Load Simulator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Benchmarking.html">Hadoop Benchmarking</a>
            </li>
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/release/index.html">Changelog and Release Notes</a>
            </li>
                  <li class="none">
                  <a href="../../../api/index.html">Java API docs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellAPI.html">Unix Shell API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Metrics.html">Metrics</a>
            </li>
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/core-default.xml">core-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/hdfs-default.xml">hdfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/hdfs-rbf-default.xml">hdfs-rbf-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml">mapred-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-common/yarn-default.xml">yarn-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DeprecatedProperties.html">Deprecated Properties</a>
            </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="../../images/logos/maven-feather.png"/>
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!---
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<h1>Controlling the S3A Directory Marker Behavior</h1>
<p>From Hadoop 3.3.1 onwards, the S3A client can be configured to skip deleting directory markers when creating files under paths. This removes all scalability problems caused by deleting these markers -however, it is achieved at the expense of backwards compatibility.</p>
<p><i>This Hadoop release is compatible with versions of Hadoop which can be configured to retain directory markers above files.</i></p>
<p><i>It does not support any options to change the marker retention policy to anything other than the default <tt>delete</tt> policy.</i></p>
<p>If the S3A filesystem is configured via <tt>fs.s3a.directory.marker.retention</tt> to use a different policy (i.e <tt>keep</tt> or <tt>authoritative</tt>), a message will be logged at INFO and the connector will use the &#x201c;delete&#x201d; policy.</p>
<p>The <tt>s3guard bucket-info</tt> tool <a href="#bucket-info">can be used to verify support</a>. This allows for a command line check of compatibility, including in scripts.</p>
<p><i>For details on alternative marker retention policies and strategies for safe usage, consult the documentation of a Hadoop release which supports the ability to change the marker policy.</i></p>
<div class="section">
<h2><a name="Verifying_marker_policy_with_s3guard_bucket-info"></a><a name="bucket-info"></a> Verifying marker policy with <tt>s3guard bucket-info</tt></h2>
<p>The <tt>bucket-info</tt> command has been enhanced to support verification from the command line of bucket policies via the <tt>-marker</tt> option</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> option </th>
<th> verifies </th></tr>
</thead><tbody>

<tr class="b">
<td> <tt>-markers aware</tt> </td>
<td> the hadoop release is &#x201c;aware&#x201d; of directory markers </td></tr>
<tr class="a">
<td> <tt>-markers delete</tt> </td>
<td> directory markers are deleted </td></tr>
<tr class="b">
<td> <tt>-markers keep</tt> </td>
<td> directory markers are kept (will always fail) </td></tr>
<tr class="a">
<td> <tt>-markers authoritative</tt> </td>
<td> directory markers are kept in authoritative paths (will always fail) </td></tr>
</tbody>
</table>
<p>All releases of Hadoop which have been updated to be marker aware will support the <tt>-markers aware</tt> option.</p>
<ol style="list-style-type: decimal">

<li>

<p>Updated releases which do not support switching marker retention policy will also support the <tt>-markers delete</tt> option.</p>
</li>
<li>

<p>As this is such a a release, the other marker options (<tt>-markers keep</tt> and  <tt>-markers authoritative</tt>)] will always fail.</p>
</li>
</ol>
<p>Probing for marker awareness: <tt>s3guard bucket-info -markers aware</tt></p>

<div>
<div>
<pre class="source">&gt; bin/hadoop s3guard bucket-info -markers aware s3a://landsat-pds/
  Filesystem s3a://landsat-pds
  Location: us-west-2
  Filesystem s3a://landsat-pds is not using S3Guard
  The &quot;magic&quot; committer is not supported
  
  S3A Client
    Endpoint: fs.s3a.endpoint=s3.amazonaws.com
    Encryption: fs.s3a.server-side-encryption-algorithm=none
    Input seek policy: fs.s3a.experimental.input.fadvise=normal
  
  The directory marker policy is &quot;delete&quot;
  
  The S3A connector can read data in S3 buckets where directory markers
  are not deleted (optional with later hadoop releases),
  and with buckets where they are.

  Available Policies: delete
</pre></div></div>

<p>The same command will fail on older releases, because the <tt>-markers</tt> option is unknown</p>

<div>
<div>
<pre class="source">&gt; hadoop s3guard bucket-info -markers aware s3a://landsat-pds/
Illegal option -markers
Usage: hadoop bucket-info [OPTIONS] s3a://BUCKET
    provide/check S3Guard information about a specific bucket

Common options:
  -guarded - Require S3Guard
  -unguarded - Force S3Guard to be disabled
  -auth - Require the S3Guard mode to be &quot;authoritative&quot;
  -nonauth - Require the S3Guard mode to be &quot;non-authoritative&quot;
  -magic - Require the S3 filesystem to be support the &quot;magic&quot; committer
  -encryption -require {none, sse-s3, sse-kms} - Require encryption policy

When possible and not overridden by more specific options, metadata
repository information will be inferred from the S3A URL (if provided)

Generic options supported are:
  -conf &lt;config file&gt; - specify an application configuration file
  -D &lt;property=value&gt; - define a value for a given property

2020-08-12 16:47:16,579 [main] INFO  util.ExitUtil (ExitUtil.java:terminate(210)) - Exiting with status 42:
 Illegal option -markers
</pre></div></div>

<p>The <tt>-markers delete</tt> option will verify that this release will delete directory markers.</p>

<div>
<div>
<pre class="source">&gt; hadoop s3guard bucket-info -markers delete s3a://landsat-pds/
 Filesystem s3a://landsat-pds
 Location: us-west-2
 Filesystem s3a://landsat-pds is not using S3Guard
 The &quot;magic&quot; committer is not supported
 
 S3A Client
    Endpoint: fs.s3a.endpoint=s3.amazonaws.com
    Encryption: fs.s3a.server-side-encryption-algorithm=none
    Input seek policy: fs.s3a.experimental.input.fadvise=normal
 
 The directory marker policy is &quot;delete&quot;

</pre></div></div>

<p>As noted: the sole option available on this Hadoop release is <tt>delete</tt>. Other policy probes will fail, returning error code 46. &#x201c;unsupported&#x201d;</p>

<div>
<div>
<pre class="source">&gt; hadoop s3guard bucket-info -markers keep s3a://landsat-pds/
Filesystem s3a://landsat-pds
Location: us-west-2
Filesystem s3a://landsat-pds is not using S3Guard
The &quot;magic&quot; committer is not supported

S3A Client
    Endpoint: fs.s3a.endpoint=s3.amazonaws.com
    Encryption: fs.s3a.server-side-encryption-algorithm=none
    Input seek policy: fs.s3a.experimental.input.fadvise=normal

The directory marker policy is &quot;delete&quot;

2020-08-25 12:20:18,805 [main] INFO  util.ExitUtil (ExitUtil.java:terminate(210)) - Exiting with status 46:
 46: Bucket s3a://landsat-pds: required marker policy is &quot;keep&quot; but actual policy is &quot;delete&quot;
</pre></div></div>

<p>Even if the bucket configuration attempts to change the marker policy, probes for <tt>keep</tt> and <tt>authoritative</tt> will fail.</p>
<p>Take, for example, a configuration for a specific bucket to delete markers under the authoritative path <tt>/tables</tt>:</p>

<div>
<div>
<pre class="source">&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.s3-london.directory.marker.retention&lt;/name&gt;
  &lt;value&gt;authoritative&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.s3-london.authoritative.path&lt;/name&gt;
  &lt;value&gt;/tables&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>The marker settings will be warned about on filesystem creation, and the marker policy to remain as <tt>delete</tt>. Thus a check for <tt>-markers authoritative</tt> will fail</p>

<div>
<div>
<pre class="source">&gt; hadoop s3guard bucket-info -markers authoritative s3a://s3-london/
2020-08-25 12:33:52,682 [main] INFO  impl.DirectoryPolicyImpl (DirectoryPolicyImpl.java:getDirectoryPolicy(163)) -
 Directory marker policy &quot;authoritative&quot; is unsupported, using &quot;delete&quot;
Filesystem s3a://s3-london
Location: eu-west-2
Filesystem s3a://s3-london is not using S3Guard
The &quot;magic&quot; committer is supported

S3A Client
    Endpoint: fs.s3a.endpoint=s3.eu-west-2.amazonaws.com
    Encryption: fs.s3a.server-side-encryption-algorithm=none
    Input seek policy: fs.s3a.experimental.input.fadvise=normal

The directory marker policy is &quot;delete&quot;

2020-08-25 12:33:52,746 [main] INFO  util.ExitUtil (ExitUtil.java:terminate(210)) - Exiting with status 46:
 46: Bucket s3a://s3-london: required marker policy is &quot;authoritative&quot; but actual policy is &quot;delete&quot;
</pre></div></div>

<div class="section">
<h3><a name="Probing_for_retention_via_PathCapabilities_and_StreamCapabilities"></a><a name="pathcapabilities"></a> Probing for retention via <tt>PathCapabilities</tt> and <tt>StreamCapabilities</tt></h3>
<p>An instance of the filesystem can be probed for its directory marker retention ability/ policy can be probed for through the <tt>org.apache.hadoop.fs.PathCapabilities</tt> interface, which all FileSystem classes have supported since Hadoop 3.2.</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> Probe                   </th>
<th> Meaning                 </th></tr>
</thead><tbody>

<tr class="b">
<td> <tt>fs.s3a.capability.directory.marker.aware</tt>  </td>
<td> Does the filesystem support surplus directory markers? </td></tr>
<tr class="a">
<td> <tt>fs.s3a.capability.directory.marker.policy.delete</tt> </td>
<td> Is the bucket policy &#x201c;delete&#x201d;? </td></tr>
<tr class="b">
<td> <tt>fs.s3a.capability.directory.marker.policy.keep</tt>   </td>
<td> Is the bucket policy &#x201c;keep&#x201d;? </td></tr>
<tr class="a">
<td> <tt>fs.s3a.capability.directory.marker.policy.authoritative</tt> </td>
<td> Is the bucket policy &#x201c;authoritative&#x201d;? </td></tr>
<tr class="b">
<td> <tt>fs.s3a.capability.directory.marker.action.delete</tt> </td>
<td> If a file was created at this path, would directory markers be deleted? </td></tr>
<tr class="a">
<td> <tt>fs.s3a.capability.directory.marker.action.keep</tt>   </td>
<td> If a file was created at this path, would directory markers be retained? </td></tr>
</tbody>
</table>
<p>The probe <tt>fs.s3a.capability.directory.marker.aware</tt> allows for a filesystem to be probed to determine if its file listing policy is &#x201c;aware&#x201d; of directory marker retention -that is: can this s3a client safely work with S3 buckets where markers have not been deleted.</p>
<p>The <tt>fs.s3a.capability.directory.marker.policy.</tt> probes return the active policy for the bucket.</p>
<p>The two <tt>fs.s3a.capability.directory.marker.action.</tt> probes dynamically query the marker retention behavior of a specific path. That is: if a file was created at that location, would ancestor directory markers be kept or deleted?</p>
<p>The <tt>S3AFileSystem</tt> class also implements the <tt>org.apache.hadoop.fs.StreamCapabilities</tt> interface, which can be used to probe for marker awareness via the <tt>fs.s3a.capability.directory.marker.aware</tt> capability.</p>
<p>Again, this will be true if-and-only-if the S3A connector is safe to work with S3A buckets/paths where directories are retained.</p>
<p>*If an S3A instance, probed by <tt>PathCapabilities</tt> or <tt>StreamCapabilities</tt> for the capability <tt>fs.s3a.capability.directory.marker.aware</tt> and it returns false, <i>it is not safe to be used with S3A paths where markers have been retained</i>.</p></div></div>
<div class="section">
<h2><a name="Glossary"></a><a name="glossary"></a> Glossary</h2>
<div class="section">
<div class="section">
<h4><a name="Directory_Marker"></a>Directory Marker</h4>
<p>An object in an S3 bucket with a trailing &#x201c;/&#x201d;, used to indicate that there is a directory at that location. These are necessary to maintain expectations about directories in an object store:</p>
<ol style="list-style-type: decimal">

<li>After <tt>mkdirs(path)</tt>, <tt>exists(path)</tt> holds.</li>
<li>After <tt>rm(path/*)</tt>, <tt>exists(path)</tt> holds.</li>
</ol>
<p>In previous releases of Hadoop, the marker created by a <tt>mkdirs()</tt> operation was deleted after a file was created. Rather than make a slow HEAD probe + optional marker DELETE of every parent path element, HADOOP-13164 switched to enumerating all parent paths and issuing a single bulk DELETE request. This is faster under light load, but as each row in the delete consumes one write operation on the allocated IOPs of that bucket partition, creates load issues when many worker threads/processes are writing to files. This problem is bad on Apache Hive as: * The hive partition structure places all files within the same S3 partition. * As they are deep structures, there are many parent entries to include in the bulk delete calls. * It&#x2019;s creating a lot temporary files, and still uses rename to commit output.</p>
<p>Apache Spark has less of an issue when an S3A committer is used -although the partition structure is the same, the delayed manifestation of output files reduces load.</p></div>
<div class="section">
<h4><a name="Leaf_Marker"></a>Leaf Marker</h4>
<p>A directory marker which has not files or directory marker objects underneath. It genuinely represents an empty directory.</p></div>
<div class="section">
<h4><a name="Surplus_Marker"></a>Surplus Marker</h4>
<p>A directory marker which is above one or more files, and so is superfluous. These are the markers which were traditionally deleted; now it is optional.</p>
<p>Older versions of Hadoop mistake such surplus markers as Leaf Markers.</p></div>
<div class="section">
<h4><a name="Versioned_Bucket"></a>Versioned Bucket</h4>
<p>An S3 Bucket which has Object Versioning enabled.</p>
<p>This provides a backup and recovery mechanism for data within the same bucket: older objects can be listed and restored through the AWS S3 console and some applications.</p></div></div></div>
<div class="section">
<h2><a name="References"></a>References</h2><!-- if extending, keep JIRAs separate, have them in numerical order; the rest in lexical.` -->

<ul>

<li>

<p><a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-13164">HADOOP-13164</a>. <i>Optimize S3AFileSystem::deleteUnnecessaryFakeDirectories.</i></p>
</li>
<li>

<p><a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-13230">HADOOP-13230</a>. <i>S3A to optionally retain directory markers</i></p>
</li>
<li>

<p><a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-16090">HADOOP-16090</a>. <i>S3A Client to add explicit support for versioned stores.</i></p>
</li>
<li>

<p><a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-16823">HADOOP-16823</a>. <i>Large DeleteObject requests are their own Thundering Herd</i></p>
</li>
<li>

<p><a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/Versioning.html">Object Versioning</a>. <i>Using versioning</i></p>
</li>
<li>

<p><a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/optimizing-performance.html">Optimizing Performance</a>. <i>Best Practices Design Patterns: Optimizing Amazon S3 Performance</i></p>
</li>
</ul></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2021
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
